<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.surveyplanet.mapper.QuestionMapper">

    <resultMap id="questionResultMap" type="org.example.surveyplanet.pojo.entity.question.Question">
        <result property="qid" column="qid"/>
        <result property="sid" column="sid"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="required" column="required"/>

        <discriminator column="type" javaType="String">
            <case value="file" resultType="org.example.surveyplanet.pojo.entity.question.FileQuestion">
                <result property="maxFileSize" column="max_file_size"/>
            </case>
            <case value="single" resultType="org.example.surveyplanet.pojo.entity.question.MultipleChoiceQuestion">
                <result property="options" column="options" typeHandler="org.example.surveyplanet.handler.QuestionOptionsHandler"/>
            </case>
            <case value="multiple" resultType="org.example.surveyplanet.pojo.entity.question.MultipleSelectQuestion">
                <result property="options" column="options" typeHandler="org.example.surveyplanet.handler.QuestionOptionsHandler"/>
            </case>
        </discriminator>
    </resultMap>


    <insert id="insert" parameterType="list">
        insert into question (sid, title, description, type, options, max_file_size, required) values
        <foreach collection="list" item="question" separator="," >
            (#{question.sid}, #{question.title}, #{question.description}, #{question.type}, #{question.optionsJson}, #{question.maxFileSize}, #{question.required})
        </foreach>
    </insert>


    <update id="update" parameterType="list">
        <foreach collection="list" item="question" separator=";">
            update question
            <set>
                title = #{question.title},
                description = #{question.description},
                type = #{question.type},
                options = #{question.optionsJson},
                max_file_size = #{question.maxFileSize},
                required = #{question.required}
            </set>
            where qid = #{question.qid}
        </foreach>
    </update>


    <select id="getBySid" resultMap="questionResultMap">
        select qid, sid, title, description, type, options, max_file_size, required from question
        where sid = #{sid}
    </select>


    <select id="delete" parameterType="list">
        delete from question
        where qid in
        <foreach collection="list" item="question" open="(" close=")" separator=",">
            #{question.qid}
        </foreach>
    </select>

</mapper>